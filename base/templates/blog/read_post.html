{% extends "blog/layout.html" %}
{% block style %}

<!--PrismJS-->
<link rel="stylesheet" href="/static/blog/style/prism_new.css">

{% endblock %}
{% block body %}
<div class="container mx-auto">
 <div id="load">
    <div>G</div>
    <div>N</div>
    <div>I</div>
    <div>D</div>
    <div>A</div>
    <div>O</div>
    <div>L</div>
</div>
    <address class="flex items-center m-5 not-italic">
        <div class="inline-flex items-center mr-3 text-sm text-gray-900 dark:text-white">
            {% if post.author.profile_photo %}
                <img class="mr-4 w-16 h-16 rounded-full" src="{{post.author.profile_photo.url}}" alt="{{post.author.first_name}} {{post.author.last_name}}">
            {% else %}
                <svg width="80" height="80" class="mr-4 w-16 h-16 jdenticon rounded-full border-2" data-jdenticon-value="{{post.author.username}}"></svg>
            {% endif %}
            <div>
                {% if post.author.first_name or post.author.last_name %}
                    <a href="#" rel="author" class="text-xl font-bold text-gray-900 dark:text-white">{{post.author.first_name}} {{post.author.last_name}}</a>
                {% else %}
                <a href="#" rel="author" class="text-xl font-bold text-gray-900 dark:text-white">{{post.author.username}}</a>
                {% endif %}
                {% if post.author.rank == "Banned" %}
                <span class="bg-red-100 text-red-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded dark:bg-red-200 dark:text-red-900">{{post.author.rank}}</span>
                {% elif not post.author.rank %}
                {% else %}
                <span class="bg-blue-100 text-blue-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800">{{post.author.rank}}</span>
                {% endif %}
                <p class="text-base font-light text-gray-500 dark:text-gray-400">{% if post.author.bio %} {{post.author.bio}} {% endif %}</p>
                <p class="text-base font-light text-gray-500 dark:text-gray-400"><time>{% if post.date == post.last_modified %}{{post.date}} {% else %} Last Modified: {{post.last_modified}} {% endif %}</time></p>
            </div>
        </div>
    </address>
    <hr>
<div id="post-page" style="display:none;">
    <!--Breadcrumbs-->    
    <nav class="flex p-2" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
        <li class="inline-flex items-center">
            <a href="#" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white">
            <i class="w-4 h-4 mr-2 fa-sharp fa-solid fa-house"></i>
            Home
            </a>
        </li>
        {% for category in post.category.get_family|slice:":2" %}
            <li>
                <div class="flex items-center">
                <i class="w-6 h-6 text-gray-400 mt-2 fa-solid fa-chevron-right"></i>
                <a href="{% url 'Blog:category' category.slug %}" class="ml-1 text-sm font-medium text-gray-700 hover:text-gray-900 md:ml-2 dark:text-gray-400 dark:hover:text-white">{{category}}</a>
                </div>
            </li>
        {% endfor %}
        {% if post.category.get_family|length > 2 %}
            <li>
                <div class="flex items-center">                    
                <i class="w-6 h-6 text-gray-400 mt-2 fa-solid fa-chevron-right"></i>
                <span>...</span>
                <a href="{% url 'Blog:category' post.category.slug %}" class="ml-1 text-sm font-medium text-gray-700 hover:text-gray-900 md:ml-2 dark:text-gray-400 dark:hover:text-white">{{post.category}}</a>
                </div>
            </li>
        {% endif %}
        </ol>
    </nav>
  
    <!--Post section-->
    {% csrf_token %}
    <h1 align="center" class="text-5xl font-extrabold dark:text-white">{{post.title}}</h1>
    <article id="post" style="font-size:20px;" class="sun-editor-editable" data-post_api="{% url 'Blog:fetch_post' post.pk %}">
        <!--Post content came here-->
    </article>
    <hr>
    <!--Post taggs-->
    <div class='my-3 ml-5 flex flex-wrap -m-1'>
        <span class="text-xl font-bold">Taggs:</span>
        {% for tag in post.tags.all|slice:'20' %}
            <a href="{% url 'Blog:tag' tag.slug %}">
            <span
            class="m-1 flex flex-wrap justify-between items-center text-xs sm:text-sm bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded px-4 py-2 font-bold leading-loose cursor-pointer dark:text-gray-300">
            {{tag}}</span></a>
        {% empty %}
        <span>&nbsp;&nbsp;Not tagged.</span> 
        {% endfor %}
    </div>
<hr>
<!--Comment Section-->
<section class="bg-white py-4 dark:bg-gray-900 lg:py-16">
  <div id='alert'></div>
    <div class="mx-auto max-w-2xl px-4">
      <div class="mb-6 flex items-center justify-between">
        {% if post.post_comment.all|length >= 1 %}
        <h2 class="text-lg font-bold text-gray-900 dark:text-white lg:text-2xl">Discussion ({{post.post_comment.all|length}})</h2>
        {% else %}
        <h2 class="text-lg font-bold text-gray-900 dark:text-white lg:text-2xl">Discussion</h2>
        {% endif %}
      </div>
      <form class="mb-6" id="comment_form" action="{% url 'Blog:comment' post.id 0 %}" method="POST">
        <div class="" id="comment_parent"></div>

        {% csrf_token %}
        <div class="mb-4 rounded-lg rounded-t-lg border border-gray-200 bg-white py-2 px-4 dark:border-gray-700 dark:bg-gray-800">
          <label for="comment" class="sr-only">Your comment</label>
          <textarea id="comment" name="comment" rows="6" maxlength="254" class="w-full border-0 px-0 text-sm text-gray-900 focus:outline-none focus:ring-0 dark:bg-gray-800 dark:text-white dark:placeholder-gray-400" placeholder="Write a comment..." required></textarea>
        </div>
        <button type="submit" id="submit_comment" class="focus:ring-primary-200 dark:focus:ring-primary-900 hover:bg-primary-800 inline-flex items-center rounded-lg bg-green-700 py-2.5 px-4 text-center text-xs font-medium text-white focus:ring-4">Post comment</button>
      </form>
      <!--Comment section-->
      {% for comment in post.post_comment.all %}
      {% if comment.level == 0 %}
      <article class="rounded-lg bg-white p-6 text-base dark:bg-gray-900">
        <footer class="justify-between items-center mb-2 flex">
          <div class="flex items-center">
            {% if comment.commenter.username %}
            {% if comment.commenter.profile_photo %}
            <p class="mr-3 inline-flex items-center text-sm text-gray-900 dark:text-white"><img class="mr-2 h-6 w-6 rounded-full" src="{{comment.commenter.profile_photo.url}}" alt="{{comment.commenter.username}}" />{{comment.commenter.username}}</p>
            {% else %}
            <p class="mr-3 inline-flex items-center text-sm text-gray-900 dark:text-white"><svg class="mr-2 h-6 w-6 jdenticon rounded-full" data-jdenticon-value="{{comment.commenter.username}}"></svg>{{comment.commenter.username}}</p>
            {% endif %}
            {% else %}
            <p class="mr-3 inline-flex items-center text-sm text-gray-900 dark:text-white"><svg class="mr-2 h-6 jdenticon w-6 rounded-full" data-jdenticon-value="anonymouse}"></svg>Anonymouse</p>
            {% endif %}
            <p class="text-sm text-gray-600 dark:text-gray-400"><time pubdate datetime="{{comment.date}}">{{comment.date}}</time></p>
          </div>
        </footer>
        <p class="text-gray-500 ml-5 dark:text-gray-400">{{comment.content}}</p>
        <div class="mt-4 flex items-center ml-5 space-x-4">
          <button type="button" class="flex items-center reply_btn text-sm text-gray-500 hover:underline dark:text-gray-400">
            <i class="fa-sharp fa-solid fa-comment mr-2"></i>
            Reply
          </button>
          
        <form class="mb-6 reply_form" id="reply_form" action="{% url 'Blog:comment' post.id 0 %}" method="POST" style="display:none">
          <div class="" id="comment_parent"></div>

          {% csrf_token %}
          <div class="mb-4 rounded-lg rounded-t-lg border border-gray-200 bg-white py-2 px-4 dark:border-gray-700 dark:bg-gray-800">
            <label for="comment" class="sr-only">Your comment</label>
            <textarea id="comment" name="comment" rows="6" maxlength="254" class="w-full border-0 px-0 text-sm text-gray-900 focus:outline-none focus:ring-0 dark:bg-gray-800 dark:text-white dark:placeholder-gray-400" placeholder="Write a comment..." required></textarea>
          </div>
          <button type="submit" id="submit_comment" class="focus:ring-primary-200 dark:focus:ring-primary-900 hover:bg-primary-800 inline-flex items-center rounded-lg bg-green-700 py-2.5 px-4 text-center text-xs font-medium text-white focus:ring-4">Post comment</button>
        </form>
        </div>
      </article>
      <!--Nested comment-->
      {% for replier in comment.get_descendants %}
      <article class="ml-12 rounded-lg bg-white p-2 text-base dark:bg-gray-900">
        <footer class="mb-2 flex items-center justify-between">
          <div class="flex items-center">
            {% if replier.commenter.username %}
            {% if replier.commenter.profile_photo %}
            <p class="mr-3 inline-flex items-center text-sm text-gray-900 dark:text-white"><img class="mr-2 h-6 w-6 rounded-full" src="{{replier.commenter.profile_photo.url}}" alt="{{replier.commenter.username}}"/>{{replier.commenter.username}}</p>
            {% else %}
            <p class="mr-3 inline-flex items-center text-sm text-gray-900 dark:text-white"><svg class="mr-2 h-6 jdenticon w-6 rounded-full" data-jdenticon-value="{{replier.commenter.username}}"></svg>{{replier.commenter.username}}</p>
            {% endif %}
            {% else %}
            <p class="mr-3 inline-flex items-center text-sm text-gray-900 dark:text-white"><svg class="mr-2 h-6 jdenticon w-6 rounded-full" data-jdenticon-value="anonymouse}"></svg>Anonymouse</p>
            {% endif %}
            <p class="text-sm text-gray-600 dark:text-gray-400"><time pubdate datetime="{{replier.date}}">{{replier.date}}</time></p>
          </div>
        </footer>
        <p class="text-gray-500 ml-5 dark:text-gray-400">{{replier.content}}</p>
        <div class="mt-4 ml-5 flex items-center space-x-4">
          <button type="button" class="flex items-center text-sm reply-btn text-gray-500 hover:underline dark:text-gray-400"><i class="fa-sharp fa-solid fa-comment mr-2"></i>Reply</button>
        </div>
      </article>
      {% endfor %}
      <!--End nested comment-->
      {% endif %}
      {% empty %}
      <div class="p-4 mb-4 text-sm text-blue-700 bg-blue-100 rounded-lg dark:bg-gray-800 dark:text-blue-400" role="alert">
        <span class="font-medium">...</span>There are have no comment yet.
      </div>
      {% endfor %}
    </div>
  </section>
  
<!--End Comment section-->
</div>
{% include "blog/suneditor.html" %}
</div>
{% endblock %}

{% block bottom_script %}

<!--PrismJS-->
<script src="/static/blog/script/prism_new.js"></script>
<!--Additional-->
<script src="/static/blog/script/render_post.js"></script>
<script src="/static/blog/script/blog_post.js"></script>


{% endblock %}